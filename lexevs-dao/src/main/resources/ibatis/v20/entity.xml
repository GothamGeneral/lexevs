<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="Entity">

	<typeAlias alias="entity" type="org.LexGrid.concepts.Entity" />

	<resultMap id="entityResult" class="entity">
		<result property="entityCode" column="entityCode" />
		<result property="entityCodeNamespace" column="entityCodeNamespace" />
	</resultMap>
	
	<sql id="getEntityFragment">
		SELECT
			entityCode,
			entityCodeNamespace
		FROM
			$prefix$entity
	</sql>
	

	<select id="getEntityByCodeAndNamespace" parameterClass="map" resultMap="Entity.entityResult">
		<include refid="getEntityFragment"/>
		WHERE
			entityCode = #entityCode#
		AND
			entityCodeNamespace = #entityCodeNamespace#
     </select>
     
     <select id="getAllEntitiesOfCodingScheme" parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter" 
     	resultMap="Entity.entityResult">
		<include refid="getEntityFragment"/>
		WHERE
			codingSchemeGuid = #param1#
     </select>
     
     <insert id="insertEntity" parameterClass="org.lexevs.dao.database.ibatis.entity.parameter.InsertEntityBean">
		INSERT INTO $prefix$entity (
			entityGuid,
			codingSchemeGuid,
			entityCode,
			entityCodeNamespace,
			isDefined,
			isAnonymous,
			isActive,
			description,
			owner,
			status,
			effectiveDate,
			expirationDate,
			entryStateGuid
		) VALUES (
			#id#, 
			#codingSchemeId#,
			#entity.entityCode#, 
			#entity.entityCodeNamespace#, 
			#entity.isDefined#,
			#entity.isAnonymous#,
			#entity.isActive#,
			#entity.entityDescription.content#,
			#entity.owner#,
			#entity.status#,
			#entity.effectiveDate#,
			#entity.expirationDate#,
			#entryStateId#
		)
  </insert>
    
</sqlMap>