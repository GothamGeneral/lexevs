<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="Association">

	<typeAlias alias="associationPredicate" type="org.LexGrid.relations.AssociationPredicate" />
	<typeAlias alias="relations" type="org.LexGrid.relations.Relations" />
	
	<resultMap id="associationPredicateResult" class="associationPredicate">
		<result property="associationName" column="associationName" />
	</resultMap>
	
	<resultMap id="relationsResult" class="relations">
		<result property="containerName" column="containerName" />
	</resultMap>
	
     <insert id="insertRelations" parameterClass="org.lexevs.dao.database.ibatis.association.parameter.InsertRelationsBean">
		INSERT INTO $prefix$relation (
			relationGuid,
			codingSchemeGuid,
			containerName,
			isMapping,
			sourceCodingScheme,
			sourceCodingSchemeVersion,
			targetCodingScheme,
			targetCodingSchemeVersion,
			description,
			isActive,
			owner,
			status,
			effectiveDate,
			expirationDate,
			entryStateGuid
		) VALUES (
			#uid#, 
			#codingSchemeUId#,
			#relations.containerName#, 
			null, 
			null, 
			null, 
			null, 
			null, 
			#relations.entityDescription.content#,
			null,
			null,
			null,
			null,
			null,
			#entryStateUId#
		)
  </insert>
  
   <insert id="insertAssociationPredicate" parameterClass="org.lexevs.dao.database.ibatis.association.parameter.InsertAssociationPredicateBean">
   		INSERT INTO $prefix$associationPredicate (
   			associationPredicateGuid,
   			relationGuid,
   			associationName
   		) VALUES (
   			#uid#,
   			#relationUId#,
   			#associationPredicate.associationName#
   		)
   </insert>

   <select id="getAssociationPredicateUid" remapResults="true"
   	parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter" resultClass="string">
   		SELECT
   			associationPredicateGuid
   		FROM
   			$prefix$associationPredicate associationPredicate
   		INNER JOIN
			$prefix$relation relation
		ON 
			(relation.relationGuid = associationPredicate.relationGuid)
		WHERE
			relation.codingSchemeGuid = #param1#
		AND
			associationName = #param1#
   </select>
   
   	<select id="getAssociationPredicatNamesFromCodingSchemeUid"
		remapResults="true" parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter" 
		resultClass="String">
		SELECT
			associationPredicate.associationName
		FROM
			$prefix$associationPredicate associationPredicate
		INNER JOIN
			$prefix$relation relation
		ON 
			(relation.relationGuid = associationPredicate.relationGuid)
		WHERE
			relation.codingSchemeGuid = #param1#
	</select>
   
  	<select id="getAssociationPredicateKeysForRelationsId" remapResults="true"
  		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter" resultClass="string">
   		SELECT
   			associationPredicateGuid
   		FROM
   			$prefix$associationPredicate
		WHERE
			relationGuid = 
			#param1#
   </select>
   
   <select id="getRelationsKey" 
    	remapResults="true" parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameterTuple" resultClass="string">
   		SELECT
   			relationGuid
   		FROM
   			$prefix$relation
		WHERE
			codingSchemeGuid = 
			#param1#
		AND
			containerName = 
			#param2#		
   </select>
   
    <select id="getRelationsKeysForCodingSchemeId" remapResults="true"
    	parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter" resultClass="string">
   		SELECT
   			relationGuid
   		FROM
   			$prefix$relation
		WHERE
			codingSchemeGuid = 
			#param1#	
   </select>
   
   <select id="getAssociationPredicateNameForId" remapResults="true"
   	parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter" resultClass="string">
   		SELECT
   			associationName
   		FROM
   			$prefix$associationPredicate
   		WHERE
			associationPredicateGuid = 
			#param1#
   </select> 
   
   <select id="getAssociationPredicateForId" remapResults="true"
   	parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter" 
   	resultMap="associationPredicateResult">
   		SELECT
   			associationName
   		FROM
   			$prefix$associationPredicate
   		WHERE
			associationPredicateGuid = 
			#param1#
   </select> 
   
   <select id="getRelationsForId" remapResults="true"
   	parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameterTuple" 
   	resultMap="relationsResult">
   		SELECT
   			containerName,
   			isMapping,
   			sourceCodingScheme,
   			sourceCodingSchemeVersion,
   			targetCodingScheme,
   			targetCodingSchemeVersion,
   			description,
   			isActive,
   			owner,
   			status,
   			effectiveDate,
   			expirationDate
   		FROM
   			$prefix$relation
   		WHERE
			codingSchemeGuid = #param1#
		AND
			relationGuid = #param2#
   </select> 
</sqlMap>