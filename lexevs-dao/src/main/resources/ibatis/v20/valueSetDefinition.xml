<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="ValueSetDefinition">

	<typeAlias alias="valueSetDefinition" type="org.LexGrid.valueSets.ValueSetDefinition" />
	<typeAlias alias="definitionEntry" type="org.LexGrid.valueSets.DefinitionEntry" />
	<typeAlias alias="entityReference" type="org.LexGrid.valueSets.EntityReference" />	
	<typeAlias alias="codingSchemeReference" type="org.LexGrid.valueSets.CodingSchemeReference" />
	<typeAlias alias="valueSetDefinitionReference" type="org.LexGrid.valueSets.ValueSetDefinitionReference" />
	<typeAlias alias="propertyReference" type="org.LexGrid.valueSets.PropertyReference" />
	<typeAlias alias="propertyMatchValue" type="org.LexGrid.valueSets.PropertyMatchValue" />
	
	<resultMap id="valueSetDefinitionResult" class="valueSetDefinition">
		<result property="valueSetDefinitionURI" column="valueSetDefURI" />
		<result property="valueSetDefinitionName" column="valueSetDefName" />
		<result property="defaultCodingScheme" column="defaultCodingScheme" />
		<result property="conceptDomain" column="conceptDomain" />
		<result property="entityDescription.content" column="description" />
		<result property="isActive" column="isActive" />
		<result property="owner" column="owner" />
		<result property="status" column="status" />
		<result property="effectiveDate" column="effectiveDate" />
		<result property="expirationDate" column="expirationDate" />
	</resultMap>
	
	<resultMap  id="definitionEntryResult" class="definitionEntry">
		<result property="ruleOrder" column="ruleOrder"/>
		<result property="operator" column="operator"/>
		<result property="isActive" column="isActive" />
		<result property="owner" column="owner" />
		<result property="status" column="status" />
		<result property="effectiveDate" column="effectiveDate" />
		<result property="expirationDate" column="expirationDate" />
		<result property="codingSchemeReference" resultMap="ValueSetDefinition.codingSchemeReferenceResult" />
		<result property="valueSetDefinitionReference" resultMap="ValueSetDefinition.valueSetDefinitionReferenceResult" />
		<result property="entityReference" resultMap="ValueSetDefinition.entityReferenceResult" />
		<result property="propertyReference" resultMap="ValueSetDefinition.propertyReferenceResult" />
	</resultMap>
	
	<resultMap  id="codingSchemeReferenceResult" class="codingSchemeReference">
		<result property="codingScheme" column="codingSchemeReference"/>
	</resultMap>
	
	<resultMap  id="valueSetDefinitionReferenceResult" class="valueSetDefinitionReference">
		<result property="valueSetDefinitionURI" column="valueSetDefReference"/>
	</resultMap>
	
	<resultMap  id="entityReferenceResult" class="entityReference">
		<result property="entityCode" column="entityCode"/>
		<result property="entityCodeNamespace" column="entityCodeNamespace"/>
		<result property="leafOnly" column="leafOnly"/>
		<result property="referenceAssociation" column="referenceAssociation"/>
		<result property="targetToSource" column="targetToSource"/>
		<result property="transitiveClosure" column="transitiveClosure"/>
	</resultMap>
	
	<resultMap  id="propertyReferenceResult" class="propertyReference">
		<result property="codingScheme" column="propertyRefCodingScheme"/>
		<result property="propertyName" column="propertyName"/>
		<result property="propertyMatchValue" resultMap="ValueSetDefinition.propertyMatchValueResult"/>
	</resultMap>
	
	<resultMap  id="propertyMatchValueResult" class="propertyMatchValue">
		<result property="matchAlgorithm" column="matchAlgorithm"/>		
		<result property="content" column="propertyMatchValue" />
		<result property="dataType" column="format" />
	</resultMap>
	
	<select id="getValueSetDefinitionURIs" 
		parameterClass="string" resultClass="string">
		SELECT
			valueSetDefURI
		FROM
			valueSetDefinition
	</select>
	
	<select id="getValueSetDefinitionGuidByValueSetDefinitionURI" 
		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter" 
		resultClass="string">
		SELECT
			valueSetDefGuid
		FROM
			valueSetDefinition
		WHERE
			valueSetDefURI = #param1#
	</select>
	
	<select id="getValueSetDefinitionByValueSetURI" 
		resultMap="valueSetDefinitionResult" 
		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter">
		SELECT
			valueSetDefURI,
			valueSetDefName,
			defaultCodingScheme,
			conceptDomain,
			description,
			isActive,
			owner,
			status,
			effectiveDate,
			expirationDate
		FROM
			valueSetDefinition
		WHERE
			valueSetDefURI = #param1#
	</select>
	
	<select id="getDefinitionEntryByValueSetGuid" 
		resultMap="definitionEntryResult" 
		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter">
		SELECT
			ruleOrder,
			operator,
			codingSchemeReference,
			valueSetDefReference,
			entityCode,
			entityCodeNamespace,
			leafOnly,
			referenceAssociation,
			targetToSource,
			transitiveClosure,
			propertyRefCodingScheme,
			propertyName,
			propertyMatchValue,
			matchAlgorithm,
			format,
			isActive,
			owner,
			status,
			effectiveDate,
			expirationDate,
			entryStateGuid
		FROM
			vsdEntry
		WHERE
			valueSetDefGuid = #param1#
	</select>
	
	<insert id="insertValueSetDefinition" 
		parameterClass="org.lexevs.dao.database.ibatis.valuesets.parameter.InsertValueSetDefinitionBean">
		INSERT INTO valueSetDefinition
		(
				valueSetDefGuid,
				valueSetDefURI,
				valueSetDefName,
				defaultCodingScheme,
				conceptDomain,
				description,
				releaseGuid,
				isActive,
				owner,
				status,
				effectiveDate,
				expirationDate,
				entryStateGuid
			) VALUES (
				#id#,
				#valueSetDefinition.valueSetDefinitionURI#,
				#valueSetDefinition.valueSetDefinitionName#,
				#valueSetDefinition.defaultCodingScheme#,
				#valueSetDefinition.conceptDomain#,
				#valueSetDefinition.entityDescription.content#,
				#systemReleaseId#,
				#valueSetDefinition.isActive#,
				#valueSetDefinition.owner#,
				#valueSetDefinition.status#,
				#valueSetDefinition.effectiveDate#,
				#valueSetDefinition.expirationDate#,
				#entryStateId#	
			)
     </insert>
     
     <insert id="insertDefinitionEntry" 
		parameterClass="org.lexevs.dao.database.ibatis.valuesets.parameter.InsertOrUpdateDefinitionEntryBean">
		INSERT INTO vsdEntry
		(
				vsdEntryGuid,
				valueSetDefGuid,
				ruleOrder,
				operator,
				codingSchemeReference,
				valueSetDefReference,
				entityCode,
				entityCodeNamespace,
				leafOnly,
				referenceAssociation,
				targetToSource,
				transitiveClosure,
				propertyRefCodingScheme,
				propertyName,
				propertyMatchValue,
				matchAlgorithm,
				format,
				isActive,
				owner,
				status,
				effectiveDate,
				expirationDate,
				entryStateGuid
			) VALUES (
				#id#,
				#valueSetDefGuid#,
				#definitionEntry.ruleOrder#,
				#definitionEntry.operator#,
				#codingSchemeReference#,
				#valueSetDefReference#,
				#entityCode#,				
				#entityCodeNamespace#,
				#leafOnly#,
				#referenceAssociation#,
				#targetToSource#,
				#transitiveClosure#,
				#propertyRefCodingScheme#,
				#propertyName#,
				#propertyMatchValue#,
				#matchAlgorithm#,
				#format#,
				#definitionEntry.isActive#,
				#definitionEntry.owner#,
				#definitionEntry.status#,
				#definitionEntry.effectiveDate#,
				#definitionEntry.expirationDate#,
				#entryStateId#	
			)
     </insert>

	<delete id="removevalueSetDefinitionByValueSetDefinitionURI" parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter">
		DELETE FROM
			valueSetDefinition
		WHERE
			valueSetDefURI = #param1#
	</delete>
	
	<delete id="removeDefinitionEntryByValueSetDefinitionGuid" parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter">
		DELETE FROM
			vsdEntry
		WHERE
			valueSetDefGuid = #param1#
	</delete>
</sqlMap>