<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="CodingScheme">

	<resultMap id="sourceResult" class="org.LexGrid.commonTypes.Source">
		<result property="content" column="attributeValue" />
		<result property="subRef" column="subRef" />
		<result property="role" column="role" />
	</resultMap>


	<resultMap id="localNameResult" class="string">
		<result property="java.lang.String" column="localNameValue" />
	</resultMap>
	
	<select id="getSourceListByCodingSchemeId" remapResults="true"
			parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter"
			resultMap="sourceResult">
		SELECT 
			attributeValue,
			subRef,
			role
		FROM 
			$prefix$csMultiAttrib
		WHERE
			codingSchemeGuid = #param1#
		AND
			attributeType = 'source'
			
	</select>
	
	<select id="getLocalNameListByCodingSchemeId" remapResults="true"
			parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter"
			resultClass="string">
		SELECT 
			attributeValue
		FROM 
			$prefix$csMultiAttrib
		WHERE
			codingSchemeGuid = #param1#
		AND
			attributeType = 'localName'
			
	</select>

	<insert id="insertCodingSchemeMultiAttrib" 
		parameterClass="org.lexevs.dao.database.ibatis.codingscheme.parameter.InsertOrUpdateCodingSchemeMultiAttribBean">
		INSERT INTO $prefix$csMultiAttrib (
			csMultiAttribGuid,
			codingSchemeGuid,
			attributeType,
			attributeValue,
			subRef,
			role,
			entryStateGuid
		) VALUES (
			#id#,
			#codingSchemeId#,
			#attributeType#,
			#attributeValue#,
			#subRef#,
			#role#,
			#entryStateId#
		)
	</insert>

	<update id="updateCodingSchemeSourceByValue"
		parameterClass="org.lexevs.dao.database.ibatis.codingscheme.parameter.InsertOrUpdateCodingSchemeMultiAttribBean">
		UPDATE
			$prefix$csMultiAttrib csMultiAttrib
		SET

		<dynamic prepend=" ">
			<isNotNull prepend="," property="subRef">
				subRef = #subRef#
			</isNotNull>
			<isNotNull prepend="," property="role">
				role = #role#
			</isNotNull>
		</dynamic>
		
		WHERE
			csMultiAttrib.codingSchemeGuid = #codingSchemeId#
		AND
			csMultiAttrib.attributeType = #attributeType#
		AND
			csMultiAttrib.attributeValue = #attributeValue#
	</update>
	
	<delete id="deleteCodingSchemeMultiAttributeByCodingSchemeId"
		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameterTuple">
		DELETE FROM
			$prefix$csMultiAttrib
		WHERE
			codingSchemeGuid = #param1#
		AND
			attributeType = #param2#
	</delete>

</sqlMap>