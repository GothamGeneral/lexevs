<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="PickList">

	<typeAlias alias="pickListDefinition" type="org.LexGrid.valueSets.PickListDefinition" />
	<typeAlias alias="pickListEntryExclusion" type="org.LexGrid.valueSets.PickListEntryExclusion" />
	<typeAlias alias="pickListEntry" type="org.LexGrid.valueSets.PickListEntry" />	
	
	<typeAlias alias="pickListEntryNodeBean" type="org.lexevs.dao.database.ibatis.valuesets.parameter.PickListEntryNodeBean" />

	<resultMap id="pickListDefinitionResult" class="pickListDefinition">
		<result property="pickListId" column="pickListId" />
		<result property="representsValueSetDefinition" column="representsValueSetDefinition" />
		<result property="defaultEntityCodeNamespace" column="defaultEntityCodeNamespace" />
		<result property="defaultLanguage" column="defaultLanguage" />
		<result property="defaultSortOrder" column="defaultSortOrder"/>
		<result property="completeSet" column="completeSet"/>
		<result property="entityDescription.content" column="description" />
		<result property="isActive" column="isActive" />
		<result property="owner" column="owner" />
		<result property="status" column="status" />
		<result property="effectiveDate" column="effectiveDate" />
		<result property="expirationDate" column="expirationDate" />
	</resultMap>
	
	<resultMap  id="pickListEntryNodeBeanResult" class="pickListEntryNodeBean">
		<result property="vsPLEntryGuid" column="vsPLEntryGuid"/>
		<result property="pickListEntryId" column="plEntryId"/>
		<result property="include" column="include" />
		<result property="isActive" column="isActive" />
		<result property="owner" column="owner" />
		<result property="status" column="status" />
		<result property="effectiveDate" column="effectiveDate" />
		<result property="expirationDate" column="expirationDate" />
		<result property="pickListEntry" resultMap="PickList.pickListEntryResult"/>		
		<result property="pickListEntryExclusion" resultMap="PickList.pickListExclusionResult"/>
	</resultMap>
	
	<resultMap  id="pickListEntryResult" class="pickListEntry">
		<result property="entityCode" column="entityCode"/>
		<result property="entityCodeNamespace" column="entityCodeNamespace"/>
		<result property="entryOrder" column="entryOrder"/>
		<result property="propertyId" column="propertyId"/>
		<result property="isDefault" column="isDefault"/>
		<result property="matchIfNoContext" column="matchIfNoContext"/>
		<result property="language" column="language"/>
		<result property="pickText" column="pickText"/>
	</resultMap>
	
	<resultMap  id="pickListExclusionResult" class="pickListEntryExclusion">
		<result property="entityCode" column="entityCode"/>
		<result property="entityCodeNamespace" column="entityCodeNamespace"/>
	</resultMap>
	
	<select id="getPickListIds" 
		parameterClass="string" resultClass="string">
		SELECT
			pickListId
		FROM
			vsPickList
	</select>
	
	<select id="getPickListGuidByPickListId" 
		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter" 
		resultClass="string">
		SELECT
			vsPickListGuid
		FROM
			vsPickList pickListDef
		WHERE
			pickListDef.pickListId = #param1#
	</select>
	
	<select id="getPickListEntryNodeGuidByPickListIdAndPLEntryId" 
		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameterTuple" 
		resultClass="string">
		SELECT
			vsPLEntryGuid
		FROM
			vsPLEntry
		WHERE
			vsPickListGuid = #param1#
		AND
			plEntryId = #param2#
	</select>
	
	<select id="getPickListDefinitionByPickListId" 
		resultMap="pickListDefinitionResult" 
		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter">
		SELECT
			pickListDef.pickListId,
			pickListDef.representsValueSetDefinition,
			pickListDef.completeSet,
			pickListDef.defaultEntityCodeNamespace,
			pickListDef.defaultLanguage,
			pickListDef.defaultSortOrder,
			pickListDef.description,			
			pickListDef.isActive,
			pickListDef.owner,
			pickListDef.status,
			pickListDef.effectiveDate,
			pickListDef.expirationDate
		FROM
			vsPickList pickListDef
		WHERE
			pickListDef.pickListId = #param1#
	</select>
	
	<select id="getPickListEntryNodeBeanByPickListGuid" 
		resultMap="PickList.pickListEntryNodeBeanResult" 
		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter">
		SELECT
			vsPLEntryGuid,
			plEntryId,
			entityCodeNamespace,
			entityCode,
			entryOrder,
			isDefault,
			matchIfNoContext,
			propertyId,
			language,
			include,
			pickText,
			isActive,
			owner,
			status,
			effectiveDate,
			expirationDate,
			entryStateGuid
		FROM
			vsPLEntry
		WHERE
			vsPickListGuid = #param1#
		ORDER BY entryOrder
     </select>
     
     <select id="getPickListDefinitionIdForValueSetDefinitionUri" 
		resultClass="string" 
		parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter">
		SELECT
			pickListDef.pickListId
		FROM
			vsPickList pickListDef
		WHERE
			pickListDef.representsValueSetDefinition = #param1#
	</select>
	
	<insert id="insertPickListDefinition" 
		parameterClass="org.lexevs.dao.database.ibatis.valuesets.parameter.InsertPickListDefinitionBean">
		INSERT INTO vsPickList
		(
				vsPickListGuid,
				pickListId,
				representsValueSetDefinition,
				completeSet,
				defaultEntityCodeNamespace,
				defaultLanguage,
				defaultSortOrder,
				description,
				releaseGuid,
				isActive,
				owner,
				status,
				effectiveDate,
				expirationDate,
				entryStateGuid
			) VALUES (
				#uid#,
				#pickListDefinition.pickListId#,
				#pickListDefinition.representsValueSetDefinition#,
				#pickListDefinition.completeSet#,
				#pickListDefinition.defaultEntityCodeNamespace#,
				#pickListDefinition.defaultLanguage#,
				#pickListDefinition.defaultSortOrder#,
				#pickListDefinition.entityDescription.content#,
				#systemReleaseUId#,
				
				<isPropertyAvailable property="pickListDefinition.isActive">
					#pickListDefinition.isActive#,
				</isPropertyAvailable>
				<isNotPropertyAvailable property="pickListDefinition.isActive">
					null,
				</isNotPropertyAvailable>				
				
				#pickListDefinition.owner#,
				#pickListDefinition.status#,
				#pickListDefinition.effectiveDate#,
				#pickListDefinition.expirationDate#,
				#entryStateUId#	
			)
     </insert>
     
     <insert id="insertPickListEntry" 
		parameterClass="org.lexevs.dao.database.ibatis.valuesets.parameter.InsertOrUpdatePickListEntryBean">
		INSERT INTO vsPLEntry
		(
				vsPLEntryGuid,
				vsPickListGuid,
				plEntryId,
				entityCodeNamespace,
				entityCode,
				entryOrder,
				isDefault,
				matchIfNoContext,
				propertyId,
				include,
				pickText,
				isActive,
				owner,
				status,
				effectiveDate,
				expirationDate,
				entryStateGuid
			) VALUES (
				#uid#,
				#pickListUId#,
				#pickListEntryNode.pickListEntryId#,
				#entityCodeNamespace#,
				#entityCode#,
				#entryOrder#,
				
				<isPropertyAvailable property="isDefault">
					#isDefault#,
				</isPropertyAvailable>
				<isNotPropertyAvailable property="isDefault">
					null,
				</isNotPropertyAvailable>
				
				<isPropertyAvailable property="matchIfNoContext">
					#matchIfNoContext#,
				</isPropertyAvailable>
				<isNotPropertyAvailable property="matchIfNoContext">
					null,
				</isNotPropertyAvailable>
				
				#propertyId#,
				
				<isPropertyAvailable property="include">
					#include#,
				</isPropertyAvailable>
				<isNotPropertyAvailable property="include">
					null,
				</isNotPropertyAvailable>
				
				#pickText#,
				
				<isPropertyAvailable property="pickListEntryNode.isActive">
					#pickListEntryNode.isActive#,
				</isPropertyAvailable>
				<isNotPropertyAvailable property="pickListEntryNode.isActive">
					null,
				</isNotPropertyAvailable>
				
				#pickListEntryNode.owner#,
				#pickListEntryNode.status#,
				#pickListEntryNode.effectiveDate#,
				#pickListEntryNode.expirationDate#,
				#entryStateUId#	
			)
     </insert>

	<delete id="removePickListDefinitionByPickListId" parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter">
		DELETE FROM
			vsPickList
		WHERE
			pickListId = #param1#
	</delete>
	
	<delete id="removePickListEntryByPickListGuid" parameterClass="org.lexevs.dao.database.ibatis.parameter.PrefixedParameter">
		DELETE FROM
			vsPLEntry
		WHERE
			vsPickListGuid = #param1#
	</delete>
</sqlMap>